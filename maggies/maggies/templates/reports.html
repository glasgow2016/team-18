{% extends "base.html" %}
{% load static i18n widget_tweaks %}

{% block extra-css %}
{% endblock %}


{% block content %}
    <div class="container">
        <!-- Example row of columns -->

        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label class="col-sm-2 col-sm-offset-3 control-label makeitright" for="id_sd">Date Range</label>
                    <div class="col-sm-4"><input id="date"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <canvas id="myChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div> <!-- /container -->
{% endblock %}

{% block extra-js %}

<script src="{% static 'js/Chart.js' %}"></script>
<script src="{% static 'js/moment.js' %}"></script>

<script>
  $('#date').daterangepicker();

  $('#date').on('apply.daterangepicker', function(ev, picker) {
    $.ajax({
      url: "/ajax_report_visitor_count",
      method: "POST",
      data: {
        start_date: picker.startDate.format('YYYY-MM-DD'),
        end_date: picker.endDate.format('YYYY-MM-DD')
      },
      cache: false
    }).done(function(response) {
        if (response.success) {
          var visitCount = response.leDates;
          var arrayOfValues = [];
          var arrayOfKeys = [];
          for (var x in visitCount) {
            arrayOfValues.push(visitCount[x]);
            arrayOfKeys.push(x);
          }


          console.log(visitCount);
          var ctx = document.getElementById("myChart");
          var myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: arrayOfKeys,
                  datasets: [{
                      label: '# of Votes',
                      data: arrayOfValues,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)',
                          'rgba(255, 206, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(153, 102, 255, 0.2)'
                      ],
                      borderColor: [
                          'rgba(255,99,132,1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero:true
                          }
                      }]
                  }
              }
          });



        }
    })
  });


</script>

{% endblock %}
